<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Engine</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CORE DARK THEME STYLES */
        :root {
            --color-background: #0d1117; 
            --color-surface: #161b22;    
            --color-text-primary: #c9d1d9;
            --color-text-secondary: #8b949e;
            --color-link: #58a6ff;      
            --color-link-hover: #79c0ff;
            --color-accent: #3fb950;     
            --color-divider: #30363d;
            --color-dot: rgba(55, 62, 73, 0.3); 
            
            --content-max-width: 1200px;
        }

        /* *************************************************************** */
        /* ***** 1. BASE STYLES & BACKGROUND (Horizontal Scroll Fix) ***** */
        /* *************************************************************** */
        
        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 0; 
            margin: 0; 
            line-height: 1.6;
            color: var(--color-text-primary);
            min-height: 100vh;
            position: relative;
            
            /* --- CRITICAL FIX: PREVENT HORIZONTAL SCROLLING --- */
            overflow-x: hidden; 
            width: 100%; /* Ensure body respects its own width */
            
            background-color: var(--color-background);
            background-image: radial-gradient(var(--color-dot) 1px, transparent 1px),
                              linear-gradient(135deg, #0d1117 0%, rgba(88, 166, 255, 0.1) 40%, rgba(255, 170, 0, 0.1) 60%, #0d1117 100%);
            
            /* The animation is a common culprit. Ensure it's contained or handled carefully. */
            background-size: 30px 30px, 400% 400%;
            background-repeat: repeat, repeat; /* Added repeat for pattern */
            
            animation: gradientShift 20s ease-in-out infinite alternate;
            will-change: background-position;
        }

        /* *************************************************************** */
        /* ***** 2. LAYOUT CONTAINERS & SEARCH BAR ***** */
        /* *************************************************************** */

        #search-container { 
            width: 100%;
            padding: 50px 15px; 
            box-sizing: border-box; /* IMPORTANT: Padding is included in the element's total width */
            text-align: center; 
            position: relative;
            z-index: 10;
        }

        .content-wrapper {
            max-width: var(--content-max-width);
            width: 100%;
            margin: 0 auto;
            padding: 0 15px; 
            box-sizing: border-box; /* IMPORTANT: Padding is included in the element's total width */
        }
        
        #search-container h1 {
            font-weight: 300;
            font-size: 3em; 
            margin-bottom: 5px;
            color: var(--color-link);
        }
        #search-container p {
            color: var(--color-text-secondary);
            margin-bottom: 40px;
        }
        
        #search-form { 
            display: flex; 
            justify-content: center; 
            max-width: 650px;
            margin: 0 auto;
            border: 2px solid var(--color-divider);
            border-radius: 50px; 
            overflow: hidden;
            background-color: var(--color-surface);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); 
            transition: box-shadow 0.3s, border-color 0.3s;
        }

        #search-form:focus-within {
            box-shadow: 0 0 15px var(--color-link), 0 10px 30px rgba(0, 0, 0, 0.8);
            border-color: var(--color-link); 
        }
        #search-input { 
            flex-grow: 1; 
            padding: 18px 25px; 
            border: none;
            background-color: transparent;
            color: var(--color-text-primary);
            font-size: 19px; 
            outline: none; 
        }
        #search-input::placeholder {
            color: var(--color-text-secondary);
            opacity: 0.8;
        }
        #search-button { 
            padding: 18px 30px; 
            background-color: var(--color-link); 
            color: #ffffff; 
            border: none; 
            cursor: pointer; 
            font-size: 19px; 
            font-weight: 500; 
            transition: background-color 0.2s, transform 0.1s; 
            text-transform: uppercase;
            border-left: 1px solid rgba(255, 255, 255, 0.1); 
        }
        #search-button:hover { 
            background-color: var(--color-link-hover); 
            transform: scale(1.02); 
        }
        
        /* *************************************************************** */
        /* ***** 3. RESULT CARD & LOAD MORE STYLES ***** */
        /* *************************************************************** */
        
        #results-container {
            padding-top: 40px; 
        }
        
        .search-result { 
            margin-bottom: 25px; padding: 15px; border-radius: 12px; 
            background-color: var(--color-surface);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
            display: flex; align-items: center; gap: 15px; position: relative; 
        }
        .search-result:hover { transform: translateY(-4px) scale(1.005); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6), 0 0 5px var(--color-link); cursor: pointer; }
        .search-result::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: transparent; border-top-left-radius: 12px; border-bottom-left-radius: 12px; transition: background-color 0.3s; }
        .search-result:hover::before { background-color: var(--color-link); }
        .featured-result { background-color: #21262d; box-shadow: 0 0 15px rgba(255, 170, 0, 0.4); padding-left: 15px; }
        .featured-result::before { background-color: #ffaa00; }
        .featured-result:hover { box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6), 0 0 10px #ffaa00; }
        .featured-result:hover::before { background-color: #ffd27a; }
        .featured-result .url { color: #ffaa00; font-weight: bold; }
        
        .favicon-wrapper { width: 72px; height: 72px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; background-color: #2a2a2a; border-radius: 10px; padding: 5px; border: 1px solid rgba(255, 255, 255, 0.05); }
        .favicon { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 6px; }
        .search-result .text-content { flex-grow: 1; min-width: 0; text-align: left; }
        .search-result a { font-size: 19px; font-weight: 500; color: var(--color-link); text-decoration: none; line-height: 1.3; display: block; margin-bottom: 3px; }
        .search-result a:hover { text-decoration: underline; color: var(--color-link-hover); }
        .search-result .url { color: #347d39; font-size: 14px; word-wrap: break-word; margin-top: 5px; }
        .search-result .snippet { color: var(--color-text-secondary); font-size: 15px; margin-top: 8px; }
        
        .message { color: var(--color-text-secondary); padding: 20px; text-align: center; }
        .message.error { color: #f85149; font-weight: bold; background-color: #381f1f; border-radius: 4px; margin-bottom: 20px; }
        .message.info-line, .gsc-branding { display: none !important; }
        
        #load-more-container { text-align: center; margin-top: 30px; margin-bottom: 50px; }
        #load-more-button { padding: 12px 35px; background-color: var(--color-surface); color: var(--color-text-primary); border: 2px solid var(--color-link); border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4); }
        #load-more-button:hover { background-color: var(--color-link); color: #ffffff; transform: translateY(-2px); box-shadow: 0 4px 15px var(--color-link); }
        #load-more-button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; background-color: var(--color-surface); color: var(--color-text-secondary); }


        /* *************************************************************** */
        /* ***** 4. MEDIA QUERIES FOR RESPONSIVENESS (Retained/Verified) ***** */
        /* *************************************************************** */

        /* Tablets and larger phones (up to 768px) */
        @media (max-width: 768px) {
            #search-container { padding: 40px 10px; }
            #search-container h1 { font-size: 2.5em; }
            #search-container p { font-size: 0.9em; margin-bottom: 30px; }
            #search-form { max-width: 95%; } 
            #search-input, #search-button { padding: 15px 20px; font-size: 17px; }
            .content-wrapper { padding: 0 10px; } 
            .favicon-wrapper { width: 60px; height: 60px; }
            .search-result a { font-size: 17px; }
            .search-result .url, .search-result .snippet { font-size: 13px; }
        }

        /* Small phones (up to 480px) */
        @media (max-width: 480px) {
            #search-container { padding: 30px 10px; }
            #search-container h1 { font-size: 2em; }
            #search-container p { font-size: 0.8em; margin-bottom: 25px; }
            #search-form {
                flex-direction: column; 
                border-radius: 10px; 
                max-width: 100%;
            }
            #search-input {
                border-bottom: 1px solid var(--color-divider); 
                border-radius: 10px 10px 0 0; 
                padding: 12px 15px;
                font-size: 16px;
                text-align: center;
            }
            #search-button {
                border-left: none; 
                border-radius: 0 0 10px 10px; 
                padding: 12px 15px;
                font-size: 16px;
                width: 100%; 
            }
            .content-wrapper { padding: 0 10px; }
            .search-result {
                flex-direction: column; 
                align-items: flex-start;
                text-align: left;
                padding: 10px;
            }
            .favicon-wrapper { width: 50px; height: 50px; margin-bottom: 10px; }
            .search-result .text-content { width: 100%; }
            .search-result a { font-size: 16px; }
            .search-result .url, .search-result .snippet { font-size: 12px; }
            #load-more-button { padding: 10px 25px; font-size: 14px; }
        }
        
        /* Animation keyframes verified not to cause overflow */
        @keyframes gradientShift {
            0% { background-position: 0% 0%, 0% 0%; }
            50% { background-position: 0% 0%, 100% 100%; }
            100% { background-position: 0% 0%, 0% 0%; }
        }

    </style>
</head>
<body>

    <div class="focal-blur-element"></div>
    
    <div id="search-container">
        <h1>SEARCH ENGINE</h1>
        <p>A fast, relevant search powered by GOOGLE.</p>
        
        <form id="search-form">
            <input type="text" id="search-input" placeholder="Type here to search" required>
            <button id="search-button" type="submit">Search</button>
        </form>
    </div>

    <div class="content-wrapper">
        <div id="results-container">
        </div>
    
        <div id="load-more-container">
        </div>
    </div>

    <script>
        // ***************************************************************
        // *** 1. YOUR API KEY ***
        const API_KEY = "";
        
        // *** 2. YOUR SEARCH ENGINE ID (CX ID) ***
        const CX_ID = ""; 
        // ***************************************************************

        // *** 3. CUSTOM PROMOTION SETTINGS ***
        const PROMOTION_URL = "https://mahdiyasser.site";
        const PROMOTION_KEYWORDS = [
            "mahdi", "mahdi yasser", "yasser", "mahdiyasser", "blog", "personal website"
        ];
        const PROMOTION_TITLE = "Mahdi Yasser's Official Website 🚀";
        const PROMOTION_SNIPPET = "This is the official personal website of Mahdi Yasser. Find articles, projects, and more here.";


        // DOM Elements
        const form = document.getElementById('search-form');
        const input = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results-container');
        const loadMoreContainer = document.getElementById('load-more-container');
        
        // State Variables for Pagination
        let currentQuery = '';
        let nextStartIndex = 1;
        let isLoading = false;


        // Event Listener for Initial Search
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = input.value.trim();
            if (query && !isLoading) {
                currentQuery = query;
                nextStartIndex = 1; // Reset to start
                resultsContainer.innerHTML = ''; // Clear old results
                loadMoreContainer.innerHTML = ''; // Clear button
                
                searchGoogle(currentQuery, nextStartIndex, false); 
            }
        });
        
        // Event Listener for Load More Button
        loadMoreContainer.addEventListener('click', function(e) {
            if (e.target.id === 'load-more-button' && nextStartIndex > 1 && !isLoading) {
                searchGoogle(currentQuery, nextStartIndex, true); // Load more text results
            }
        });


        /**
         * Main function to fetch text search results.
         */
        async function searchGoogle(query, start, append) {
            isLoading = true;
            const loadButton = document.getElementById('load-more-button');
            const searchButton = document.getElementById('search-button');

            if (loadButton) loadButton.disabled = true;
            searchButton.disabled = true;

            if (!append) {
                resultsContainer.innerHTML = '<p class="message">Searching web results...</p>';
            }

            const lowerQuery = query.toLowerCase();
            const isPromotionQuery = PROMOTION_KEYWORDS.some(keyword => lowerQuery.includes(keyword));

            const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX_ID}&q=${encodeURIComponent(query)}&start=${start}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (!append) {
                    resultsContainer.innerHTML = ''; 
                }

                displayResults(data, isPromotionQuery, append);

            } catch (error) {
                console.error('Web Search failed:', error);
                if (!append) {
                    resultsContainer.innerHTML = '<p class="message error">An error occurred while connecting to the web search API. Check your network or API settings.</p>';
                } else {
                    const messageP = document.createElement('p');
                    messageP.className = 'message error';
                    messageP.textContent = 'Error loading more results.';
                    resultsContainer.appendChild(messageP);
                }
            } finally {
                isLoading = false;
                if (loadButton) loadButton.disabled = false;
                searchButton.disabled = false;
            }
        }

        /**
         * Renders the text search results and updates pagination state.
         */
        function displayResults(data, isPromotionQuery, append) {
            loadMoreContainer.innerHTML = ''; // Clear existing button/message

            if (data.error) {
                resultsContainer.innerHTML = `<p class="message error">API Error: ${data.error.message}</p>`;
                return;
            }

            let items = data.items || [];
            
            // --- Custom Promotion Logic ---
            if (!append && isPromotionQuery) {
                const customPromotion = {
                    title: PROMOTION_TITLE, htmlTitle: PROMOTION_TITLE, link: PROMOTION_URL,
                    displayLink: PROMOTION_URL.replace('https://', ''), snippet: PROMOTION_SNIPPET,
                    htmlSnippet: PROMOTION_SNIPPET, isFeatured: true 
                };
                items = items.filter(item => item.link !== PROMOTION_URL);
                items.unshift(customPromotion);
            }
            // --- End Custom Promotion Logic ---

            if (items.length === 0 && !append) {
                resultsContainer.innerHTML = `<p class="message">No web results found for **${input.value}**.</p>`;
                return;
            }

            items.forEach(item => {
                const resultDiv = document.createElement('div');
                resultDiv.className = item.isFeatured ? 'search-result featured-result' : 'search-result';

                const faviconWrapperDiv = document.createElement('div');
                faviconWrapperDiv.className = 'favicon-wrapper';
                const faviconImg = document.createElement('img');
                faviconImg.className = 'favicon';
                faviconImg.src = getFaviconUrl(item.link);
                faviconImg.alt = 'favicon';
                faviconWrapperDiv.appendChild(faviconImg);
                resultDiv.appendChild(faviconWrapperDiv); 

                const textContentDiv = document.createElement('div');
                textContentDiv.className = 'text-content';

                const link = document.createElement('a');
                link.href = item.link;
                link.innerHTML = item.htmlTitle || item.title; 
                link.target = '_blank';
                textContentDiv.appendChild(link);
                
                const urlSpan = document.createElement('div');
                urlSpan.className = 'url';
                urlSpan.textContent = item.displayLink;
                textContentDiv.appendChild(urlSpan);

                const snippetP = document.createElement('p');
                snippetP.className = 'snippet';
                snippetP.innerHTML = item.htmlSnippet || item.snippet; 
                textContentDiv.appendChild(snippetP);

                resultDiv.appendChild(textContentDiv); 
                resultsContainer.appendChild(resultDiv);
            });
            
            // --- Pagination Logic ---
            const queries = data.queries;
            if (queries && queries.nextPage && queries.nextPage.length > 0) {
                nextStartIndex = queries.nextPage[0].startIndex;
                
                const loadMoreButton = document.createElement('button');
                loadMoreButton.id = 'load-more-button';
                loadMoreButton.textContent = 'Load More Web Results';
                loadMoreContainer.appendChild(loadMoreButton);
            } else if (append && items.length > 0) {
                 const noMoreP = document.createElement('p');
                 noMoreP.className = 'message';
                 noMoreP.textContent = 'You have reached the end of the web results.';
                 loadMoreContainer.appendChild(noMoreP);
            }
        }

        /**
         * Generates the URL for a site's favicon.
         */
        function getFaviconUrl(link) {
            try {
                const url = new URL(link);
                const domain = url.origin;
                return `https://s2.googleusercontent.com/s2/favicons?domain=${domain}&sz=128`;
            } catch (e) {
                return ""; 
            }
        }
    </script>
</body>
</html>
